# 中国联通自动化脚本

这是一个专为中国联通APP设计的高效自动化脚本，采用Python编写，旨在帮助用户自动完成日常签到、领现金、权益超市及各类专区活动。脚本基于异步IO架构，支持多账号并发运行，具有高度的稳定性和可扩展性。

## 代码结构详解

```text
中国联通.py
├── MarketRaffleState (全局奖池状态类)
│   ├── __init__ .................... 初始化奖池状态/锁
│   └── check_prizes ................ 查询奖池(全局单次,多账号共享)
│
├── Logger (日志管理类)
│   ├── __init__ .................... 初始化日志前缀
│   └── log ......................... 输出带时间戳的日志
│
├── HttpClient (网络请求类)
│   ├── __init__ .................... 初始化 Session/Headers
│   └── request ..................... 发送 HTTP 请求(含重试/Cookie管理)
│
├── CustomUserService (核心业务类)
│   │
│   ├── [基础功能]
│   ├── __init__ .................... 初始化账号信息
│   ├── online ...................... Token登录
│   ├── open_plat_line_new .......... 获取业务 Ticket
│   ├── get_bizchannelinfo .......... 生成业务渠道 Header
│   └── get_epay_authinfo ........... 生成支付认证 Header
│   │
│   ├── [日常签到 Sign]
│   ├── sign_task ................... 签到任务入口
│   ├── sign_get_continuous ......... 获取签到状态
│   ├── sign_day_sign ............... 执行签到
│   ├── sign_task_center ............ 任务中心(自动完成任务并领取奖励)
│   ├── sign_do_task_from_list ...... 执行任务中心任务
│   ├── sign_get_task_reward ........ 领取任务奖励
│   ├── sign_month_reward ........... 月签到连签礼奖励
│   └── sign_coupon_exchange ........ 话费红包兑换话费券
│   │
│   ├── [天天领现金 TTLXJ]
│   ├── ttlxj_task .................. 领现金任务入口
│   ├── ttlxj_authorize ............. 业务授权
│   ├── ttlxj_login ................. 业务登录
│   ├── ttlxj_unify_draw_new ........ 执行打卡/抽奖
│   └── ttlxj_query_available ....... 查询余额
│   │
│   ├── [联通祝福 Wocare]
│   ├── ltzf_task ................... 祝福任务入口
│   ├── wocare_get_token ............ 获取 Token
│   ├── wocare_api .................. 通用 API 请求(含解密)
│   ├── wocare_get_draw_task ........ 获取任务列表
│   ├── wocare_complete_task ........ 完成任务
│   └── wocare_luck_draw ............ 执行抽奖
│   │
│   ├── [权益超市 Market]
│   ├── market_task ................. 超市任务入口
│   ├── market_login ................ 超市登录
│   ├── market_share_task ........... 分享小红书任务(自动完成获取抽奖机会)
│   ├── market_watering_task ........ 浇花任务(支持多次浇花直到完成)
│   ├── market_watering ............. 执行浇花
│   ├── market_raffle_task .......... 抽奖任务(可选展示奖池信息)
│   ├── market_validate_captcha ..... 人机验证处理
│   ├── market_raffle ............... 执行抽奖
│   └── market_privilege_task ....... 优享权益每日领取
│   │
│   ├── [新疆专区 Xinjiang]
│   ├── xj_task ..................... 新疆任务入口(含归属地校验)
│   ├── xj_do_draw .................. 执行活动抽奖
│   ├── xj_usersday_task ............ 会员日任务入口
│   └── xj_usersday_draw ............ 会员日抽奖
│   │
│   ├── [商都福利 ShangDu - 河南]
│   ├── shangdu_task ................ 商都任务入口(含归属地校验)
│   ├── shangdu_get_ticket .......... 获取 Ticket
│   ├── shangdu_login ............... 激活 Ticket
│   └── shangdu_signin .............. 执行签到
│   │
│   ├── [云手机活动 Cloud Phone]
│   ├── wostore_cloud_task .......... 云手机任务入口
│   ├── wostore_cloud_login ......... 两步登录获取Token
│   ├── wostore_cloud_get_coupon .... 领取优惠券
│   ├── wostore_cloud_task_list ..... 查询任务列表
│   ├── wostore_cloud_get_chance .... 领取抽奖次数
│   └── wostore_cloud_draw .......... 执行抽奖
│   │
│   ├── [联通安全管家 Security Butler]
│   ├── security_butler_task ........ 安全管家任务入口
│   ├── _sec_get_ticket_by_native ... 获取Ticket
│   ├── _sec_get_auth_token ......... 获取认证Token
│   ├── _sec_add_to_blacklist ....... 添加黑名单任务
│   ├── _sec_mark_phone_number ...... 号码标记任务
│   ├── _sec_sync_address_book ...... 同步通讯录任务
│   ├── _sec_set_interception_rules . 设置拦截规则任务
│   ├── _sec_view_weekly_summary .... 查看周报任务
│   ├── _sec_sign_in ................ 签到任务
│   ├── _sec_receive_points ......... 领取积分
│   └── _sec_get_user_info .......... 查询积分信息
│   │
│   └── [联通阅读 Woread]
│       ├── woread_task ............. 阅读任务入口
│       ├── woread_auth ............. 设备预登录获取accesstoken
│       ├── woread_login ............ 账号登录(双重加密)
│       ├── woread_get_book_info .... 获取书籍/章节信息
│       ├── woread_read_process ..... 模拟阅读(心跳+时长)
│       ├── woread_draw_new ......... 抽奖(活动ID:8051)
│       └── woread_queryTicketAccount 查询话费红包余额
│
└── main (主程序入口) ............... 并发调度所有账号任务
```

## 功能特性

### Token登录
- 使用抓包获取的 `token_online` 登录，稳定可靠
- 支持多账号，使用 `@` 符号分隔

### 权益超市
- **接口自动解密**: 自动处理权益超市接口的 AES 加密响应
- **分享任务自动完成**: 自动完成分享小红书任务，获取额外抽奖机会
- **每日自动抽奖**: 无条件执行抽奖，不受奖池状态影响
- **奖池信息展示**: 抽奖完成后展示今日奖池信息（显示任意中奖率>0的奖品）
- **人机验证处理**: 抽奖触发人机验证时自动处理并继续抽奖
- **浇花任务**: 支持多次浇花直到完成目标次数
- **优享权益**: 每日自动领取一款优享权益（优先惊喜权益）
- **全局奖池查询**: 多账号只查询一次奖池，共享结果

### 云手机活动
- **自动领券**: 每日自动领取优惠券
- **任务状态同步**: 自动触发任务状态同步
- **每日抽奖**: 完成任务后自动执行抽奖

### 签到区-任务中心
- **任务自动完成**: 自动浏览任务页面并完成任务
- **奖励自动领取**: 任务完成后自动领取奖励
- **月签到奖励**: 自动检查并领取每月连签礼奖励
- **话费券兑换**: 支持使用话费红包兑换话费券（可配置兑换面额）

### 联通安全管家
- **每日签到**: 自动完成安全管家签到任务
- **积分任务**: 自动完成添加黑名单、号码标记、同步通讯录、骚扰拦截设置、查看周报等任务
- **积分领取**: 任务完成后自动领取积分奖励

### 联通阅读
- **自动登录**: 设备预登录+账号登录双重认证
- **模拟阅读**: 自动获取书籍信息并模拟阅读
- **每日抽奖**: 完成阅读任务后自动执行抽奖
- **余额查询**: 显示话费红包余额

## 快速开始

### 1. 安装依赖
```bash
pip install httpx pycryptodome
```

### 2. 配置账号

脚本通过环境变量 `chinaUnicomCookie` 获取用户登录信息。

#### 获取 token_online

**方式一：使用登录脚本（推荐）**

1. 编辑 `login.py`，填入手机号和短信验证码
2. 运行 `python login.py`
3. 控制台输出的字符串即为 `token_online`

```python
Mobile = "18812345678"  # 填入手机号
SMS_code = "123456"     # 填入短信验证码
```

**方式二：抓包获取**

1. 使用抓包工具（如Stream、Fiddler）抓取中国联通APP的请求
2. 找到 `https://m.client.10010.com/mobileService/onLine.htm` 请求
3. 提取请求体中的 `token_online` 值

#### 配置环境变量

```bash
# 单账号
export chinaUnicomCookie="your_token_online_string"

# 多账号（使用 @ 分隔）
export chinaUnicomCookie="token1@token2@token3"
```

### 3. 可选配置

编辑 `中国联通.py` 文件顶部的常量：

```python
SHOW_PRIZE_POOL = True  # 是否显示权益超市奖品池信息

# 话费券兑换配置 (需要在抢兑时间段内: 10:00-14:00, 18:00-22:00)
EXCHANGE_COUPON_CONFIG = {
    "1元话费券": False,   # 100积分, 满20元可用
    "3元话费券": False,   # 300积分, 满30元可用
    "5元话费券": True,    # 500积分, 满50元可用
    "10元话费券": True,   # 1000积分, 满100元可用
    "18元话费券": False,  # 1800积分, 满200元可用
}
```

### 4. 运行脚本
```bash
python 中国联通.py
```

### 5. 查看运行结果

脚本运行后，将在控制台输出详细的执行日志：
- **登录状态**: 显示登录成功/失败及脱敏后的手机号（如 `138****5678`）
- **任务进度**: 实时显示各个任务的执行情况
- **抽奖结果**: 显示具体的奖品名称

#### 奖池查询输出示例
```
======================================================================
权益超市奖品池查询
======================================================================
今日奖池共 8 个奖品:

奖品名称                               普通    VIP 新会员  Limit
----------------------------------------------------------------------
优酷VIP会员1天卡                        0%     5%     8%    100
埋堆堆体验会员周卡                       0%     5%     8%     50
名创优品8折折扣券                        5%    10%    12%   1500
喜茶单杯9折券                           5%    10%    12%    500
茶百道6元免配券                          5%    10%    12%   1500
======================================================================
```

## 注意事项

- **HTTP/2**: 为保证稳定性，脚本默认关闭了HTTP/2支持
- **异常处理**: 脚本内置了完善的异常捕获机制，单个任务的失败不会影响其他任务或账号的执行
- **隐私安全**: 所有敏感信息（如手机号）在日志输出时均会自动脱敏
- **奖池共享**: 权益超市奖池查询只执行一次，所有账号共享结果

## 免责声明

1. **仅供学习交流**：本项目仅供编程学习和技术交流使用，请勿用于任何商业用途。
2. **合法使用**：请勿将本脚本用于任何非法目的，包括但不限于恶意攻击、刷单等行为。
3. **风险自担**：使用本脚本产生的任何后果（包括但不限于账号封禁、财产损失等）由使用者自行承担，开发者不承担任何责任。
4. **隐私保护**：本项目不会收集用户的任何敏感信息，所有数据均保存在用户本地。
5. **侵权联系**：如果本项目侵犯了您的权益，请及时联系开发者进行处理。
